<h3>Select One(1) Item at a time for: {{ customer.name }}</h3>
<h4>Wallet Balance: â‚¦ {{ customer.wallet.balance }}</h4>

<!-- Search field to filter items -->
<div class="mb-3">
    <input type="text" class="form-control" id="item-search" name="query" placeholder="Search for items..."
        hx-get="{% url 'search_customer_items' customer.id %}" hx-trigger="keyup changed delay:500ms"
        hx-target="#for-customer" hx-swap="outerHTML">
</div>

<form method="post" hx-post="{% url 'select_items' customer.id %}" hx-target="#item-selection">
    {% csrf_token %}
    <div id="item-selection">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Select</th>
                    <th>Item</th>
                    <th>Price</th>
                    <th>Stock Available</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody id="for-customer">
                {% for item in items %}
                <tr>
                    <td>
                        <input type="checkbox" name="item_ids" value="{{ item.id }}">
                    </td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.price }}</td>
                    <td>{{ item.stock_quantity }}</td>
                    <td>
                        <input type="number" name="quantities" min="1" max="{{ item.stock_quantity }}" value="1"
                            class="form-control input-sm" disabled>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <button type="submit" class="btn btn-success">Proceed with Purchase</button>
</form>

<script>
    // Enable quantity input only when the item is selected
    document.querySelectorAll('input[type="checkbox"]').forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
            const quantityInput = this.closest('tr').querySelector('input[type="number"]');
            quantityInput.disabled = !this.checked;
        });
    });
</script>